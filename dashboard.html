<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•”í˜¸í™”í ëŒ€ì‹œë³´ë“œ - ì „ì²´ ë¶„ì„</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .card-title {
            font-size: 1.2em;
            color: #667eea;
            margin-bottom: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .price-display {
            display: flex;
            align-items: baseline;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .current-price {
            font-size: 2.5em;
            font-weight: bold;
            color: #2c3e50;
        }

        .big-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }

        .price-change {
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .price-up {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .price-down {
            background: #ffebee;
            color: #c62828;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .stat-value {
            font-weight: 600;
            color: #2c3e50;
            text-align: right;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.2em;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .last-update {
            text-align: center;
            color: white;
            font-size: 0.9em;
            margin-top: 20px;
            opacity: 0.8;
        }

        .filter-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            font-size: 0.9em;
            color: #667eea;
            font-weight: 600;
        }

        .filter-input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .filter-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .filter-button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .filter-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .filter-button:active {
            transform: translateY(0);
        }

        .date-range-display {
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
            display: block;
        }

        .data-table thead {
            position: sticky;
            top: 0;
            background: #667eea;
            color: white;
            z-index: 10;
        }

        .data-table th {
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
        }

        .data-table tbody {
            display: block;
            max-height: 350px;
            overflow-y: auto;
        }

        .data-table tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        .data-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #ecf0f1;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

        .highlight-positive {
            color: #2e7d32;
            font-weight: 600;
        }

        .highlight-negative {
            color: #c62828;
            font-weight: 600;
        }

        .section-title {
            color: white;
            font-size: 1.8em;
            margin: 40px 0 20px 0;
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .icon {
            font-size: 1.2em;
        }

        @media (max-width: 1024px) {
            .dashboard-grid-2 {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .current-price {
                font-size: 2em;
            }

            .filter-grid {
                grid-template-columns: 1fr;
            }

            .data-table {
                font-size: 0.8em;
            }

            .filter-container > div:first-of-type {
                grid-template-columns: 1fr !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš€ ì•”í˜¸í™”í ì™„ì „ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h1>
            <p class="subtitle">ë¹„íŠ¸ì½”ì¸(BTC) ëª¨ë“  ë°ì´í„° ë° ê¸°ìˆ ì  ë¶„ì„</p>
        </header>

        <div id="loading" class="loading">
            ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
        </div>

        <div id="error" style="display:none;" class="error"></div>

        <div id="dashboard" style="display:none;">
            <!-- ì•”í˜¸í™”í ì„ íƒ ë° ë‚ ì§œ í•„í„° -->
            <div class="filter-container">
                <div class="card-title">ğŸª™ ì•”í˜¸í™”í ì„ íƒ & ê¸°ê°„ ì„¤ì •</div>
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 15px; align-items: end; margin-bottom: 15px;">
                    <div class="filter-group">
                        <label class="filter-label">ì•”í˜¸í™”í</label>
                        <select id="coinSelect" class="filter-input" onchange="onCoinChange()">
                            <option value="">ì•”í˜¸í™”íë¥¼ ì„ íƒí•˜ì„¸ìš”...</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">ë°ì´í„° ê°œìˆ˜</label>
                        <select id="dataCount" class="filter-input">
                            <option value="30">30ì¼</option>
                            <option value="60">60ì¼</option>
                            <option value="100" selected>100ì¼</option>
                            <option value="200">200ì¼</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">ê¸°ì¤€ì¼</label>
                        <input type="date" id="baseDate" class="filter-input">
                    </div>
                    <button class="filter-button" onclick="loadCoinData()">ë°ì´í„° ë¡œë“œ</button>
                </div>
                <div class="filter-grid">
                    <div class="filter-group">
                        <label class="filter-label">ì‹œì‘ì¼</label>
                        <input type="date" id="startDate" class="filter-input">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">ì¢…ë£Œì¼</label>
                        <input type="date" id="endDate" class="filter-input">
                    </div>
                    <button class="filter-button" onclick="applyDateFilter()">í•„í„° ì ìš©</button>
                </div>
                <div class="date-range-display" id="dateRangeDisplay"></div>
            </div>

            <h2 class="section-title">ğŸ’° ì£¼ìš” ê°€ê²© ì •ë³´</h2>

            <!-- ì£¼ìš” ì§€í‘œ ì¹´ë“œ -->
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-title"><span class="icon">ğŸ’µ</span> í˜„ì¬ ê°€ê²©</div>
                    <div class="price-display">
                        <span class="current-price" id="currentPrice">-</span>
                        <span class="price-change" id="priceChange">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ì „ì¼ ì¢…ê°€</span>
                        <span class="stat-value" id="prevClose">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ê°€ê²© ë³€ë™ì•¡</span>
                        <span class="stat-value" id="changePrice">-</span>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title"><span class="icon">ğŸ“Š</span> ì¼ì¼ ë³€ë™</div>
                    <div class="stat-row">
                        <span class="stat-label">ì‹œê°€</span>
                        <span class="stat-value" id="openPrice">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ìµœê³ ê°€</span>
                        <span class="stat-value" id="highPrice">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ìµœì €ê°€</span>
                        <span class="stat-value" id="lowPrice">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ë³€ë™í­</span>
                        <span class="stat-value" id="priceRange">-</span>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title"><span class="icon">ğŸ’</span> ê±°ë˜ëŸ‰</div>
                    <div class="stat-row">
                        <span class="stat-label">ê±°ë˜ëŸ‰ (BTC)</span>
                        <span class="stat-value" id="tradeVolume">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ê±°ë˜ëŒ€ê¸ˆ</span>
                        <span class="stat-value" id="tradePrice">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">í‰ê·  ê±°ë˜ê°€</span>
                        <span class="stat-value" id="avgPrice">-</span>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title"><span class="icon">ğŸ“ˆ</span> ê¸°ê°„ í†µê³„</div>
                    <div class="stat-row">
                        <span class="stat-label">ê¸°ê°„ ìµœê³ ê°€</span>
                        <span class="stat-value" id="periodHighPrice">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ê¸°ê°„ ìµœì €ê°€</span>
                        <span class="stat-value" id="periodLowPrice">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">í‰ê· ê°€</span>
                        <span class="stat-value" id="periodAvgPrice">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ì´ ê±°ë˜ëŸ‰</span>
                        <span class="stat-value" id="totalVolume">-</span>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title"><span class="icon">ğŸ“‰</span> ë³€ë™ì„± ë¶„ì„</div>
                    <div class="stat-row">
                        <span class="stat-label">í‰ê·  ë³€ë™ë¥ </span>
                        <span class="stat-value" id="avgChangeRate">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ìµœëŒ€ ë³€ë™ë¥ </span>
                        <span class="stat-value" id="maxChangeRate">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">í‰ê·  ì¼ì¼ ë³€ë™í­</span>
                        <span class="stat-value" id="avgDailyRange">-</span>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title"><span class="icon">ğŸ¯</span> ì¶”ì„¸ ë¶„ì„</div>
                    <div class="stat-row">
                        <span class="stat-label">ìƒìŠ¹ì¼</span>
                        <span class="stat-value" id="upDays">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">í•˜ë½ì¼</span>
                        <span class="stat-value" id="downDays">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ìŠ¹ë¥ </span>
                        <span class="stat-value" id="winRate">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ê¸°ê°„ ëˆ„ì  ìˆ˜ìµë¥ </span>
                        <span class="stat-value" id="totalReturn">-</span>
                    </div>
                </div>
            </div>

            <h2 class="section-title">ğŸ“Š ì°¨íŠ¸ ë¶„ì„</h2>

            <!-- ì¼ë´‰ ìº”ë“¤ìŠ¤í‹± ì°¨íŠ¸ -->
            <div class="chart-container">
                <div class="card-title">ğŸ“Š ì¼ë´‰ ìº”ë“¤ì°¨íŠ¸ (OHLC)</div>
                <div class="chart-wrapper">
                    <canvas id="candlestickChart"></canvas>
                </div>
            </div>

            <!-- 2ì—´ ì°¨íŠ¸ ê·¸ë¦¬ë“œ -->
            <div class="dashboard-grid-2">
                <!-- ê°€ê²© ì°¨íŠ¸ with ì´ë™í‰ê· ì„  -->
                <div class="chart-container">
                    <div class="card-title">ğŸ“ˆ ê°€ê²© ì¶”ì´ & ì´ë™í‰ê· ì„ </div>
                    <div class="chart-wrapper">
                        <canvas id="priceChart"></canvas>
                    </div>
                </div>

                <!-- ê±°ë˜ëŸ‰ ì°¨íŠ¸ -->
                <div class="chart-container">
                    <div class="card-title">ğŸ’¹ ê±°ë˜ëŸ‰ ì¶”ì´</div>
                    <div class="chart-wrapper">
                        <canvas id="volumeChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- ì¶”ê°€ ë¶„ì„ ì°¨íŠ¸ -->
            <div class="dashboard-grid-2">
                <!-- ì¼ì¼ ë³€ë™ë¥  ì°¨íŠ¸ -->
                <div class="chart-container">
                    <div class="card-title">ğŸ“‰ ì¼ì¼ ë³€ë™ë¥ </div>
                    <div class="chart-wrapper">
                        <canvas id="changeRateChart"></canvas>
                    </div>
                </div>

                <!-- ì¼ì¼ ë³€ë™í­ ì°¨íŠ¸ -->
                <div class="chart-container">
                    <div class="card-title">ğŸ“ ì¼ì¼ ê°€ê²© ë³€ë™í­</div>
                    <div class="chart-wrapper">
                        <canvas id="rangeChart"></canvas>
                    </div>
                </div>
            </div>

            <h2 class="section-title">ğŸ“‹ ìƒì„¸ ë°ì´í„° í…Œì´ë¸”</h2>

            <!-- ë°ì´í„° í…Œì´ë¸” -->
            <div class="card">
                <div class="card-title">ğŸ“‘ ì „ì²´ ë°ì´í„°</div>
                <table class="data-table" id="dataTable">
                    <thead>
                        <tr>
                            <th>ë‚ ì§œ</th>
                            <th>ì‹œê°€</th>
                            <th>ê³ ê°€</th>
                            <th>ì €ê°€</th>
                            <th>ì¢…ê°€</th>
                            <th>ë³€ë™ë¥ </th>
                            <th>ê±°ë˜ëŸ‰</th>
                            <th>ê±°ë˜ëŒ€ê¸ˆ</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                    </tbody>
                </table>
            </div>

            <div class="last-update">
                ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="lastUpdate">-</span> | ë°ì´í„° ì œê³µ: Upbit API
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let allData = [];
        let filteredData = [];
        let priceChartInstance = null;
        let volumeChartInstance = null;
        let candlestickChartInstance = null;
        let changeRateChartInstance = null;
        let rangeChartInstance = null;
        let availableMarkets = [];
        let currentMarket = 'KRW-BTC';
        let currentCoinName = 'ë¹„íŠ¸ì½”ì¸';

        // ìˆ«ì í¬ë§·íŒ… í•¨ìˆ˜
        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(Math.round(num));
        }

        function formatDecimal(num, decimals = 2) {
            return new Intl.NumberFormat('ko-KR', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            }).format(num);
        }

        function formatLargeNumber(num) {
            if (num >= 1000000000000) {
                return formatDecimal(num / 1000000000000, 2) + 'ì¡°';
            } else if (num >= 100000000) {
                return formatDecimal(num / 100000000, 2) + 'ì–µ';
            } else if (num >= 10000) {
                return formatDecimal(num / 10000, 2) + 'ë§Œ';
            }
            return formatNumber(num);
        }

        // ë‚ ì§œ í¬ë§·íŒ… í•¨ìˆ˜
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }

        function formatDateForInput(dateString) {
            const date = new Date(dateString);
            return date.toISOString().split('T')[0];
        }

        // ë§ˆì¼“ ëª©ë¡ ë¡œë“œ
        async function loadMarkets() {
            try {
                const response = await fetch('https://api.upbit.com/v1/market/all?isDetails=true');
                if (!response.ok) {
                    throw new Error('ë§ˆì¼“ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                const markets = await response.json();
                // KRW ë§ˆì¼“ë§Œ í•„í„°ë§
                availableMarkets = markets.filter(m => m.market.startsWith('KRW-'));
                
                // ì…€ë ‰íŠ¸ ë°•ìŠ¤ì— ì˜µì…˜ ì¶”ê°€
                const select = document.getElementById('coinSelect');
                select.innerHTML = '<option value="">ì•”í˜¸í™”íë¥¼ ì„ íƒí•˜ì„¸ìš”...</option>';
                
                availableMarkets.forEach(market => {
                    const option = document.createElement('option');
                    option.value = market.market;
                    option.textContent = `${market.korean_name} (${market.market})`;
                    select.appendChild(option);
                });
                
                // ê¸°ë³¸ê°’ìœ¼ë¡œ BTC ì„ íƒ
                select.value = 'KRW-BTC';
                
            } catch (error) {
                console.error('Error loading markets:', error);
                alert('ì•”í˜¸í™”í ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì•”í˜¸í™”í ë³€ê²½ ì´ë²¤íŠ¸
        function onCoinChange() {
            const select = document.getElementById('coinSelect');
            currentMarket = select.value;
            
            if (currentMarket) {
                const selected = availableMarkets.find(m => m.market === currentMarket);
                currentCoinName = selected ? selected.korean_name : currentMarket;
            }
        }

        // ì½”ì¸ ë°ì´í„° ë¡œë“œ
        async function loadCoinData() {
            const market = document.getElementById('coinSelect').value;
            const count = document.getElementById('dataCount').value;
            const baseDate = document.getElementById('baseDate').value;
            
            if (!market) {
                alert('ì•”í˜¸í™”íë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!baseDate) {
                alert('ê¸°ì¤€ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('dashboard').style.display = 'none';
                
                // Upbit API í˜¸ì¶œ
                const url = `https://api.upbit.com/v1/candles/days?market=${market}&count=${count}&to=${baseDate} 00:00:00`;
                const response = await fetch(url, {
                    headers: { "accept": "application/json" }
                });
                
                if (!response.ok) {
                    throw new Error('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                allData = await response.json();
                filteredData = [...allData];
                
                if (allData.length === 0) {
                    throw new Error('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // ë‚ ì§œ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                const oldestDate = allData[allData.length - 1].candle_date_time_kst;
                const newestDate = allData[0].candle_date_time_kst;
                document.getElementById('startDate').value = formatDateForInput(oldestDate);
                document.getElementById('endDate').value = formatDateForInput(newestDate);
                
                // í—¤ë” ì—…ë°ì´íŠ¸
                document.querySelector('header .subtitle').textContent = `${currentCoinName} ëª¨ë“  ë°ì´í„° ë° ê¸°ìˆ ì  ë¶„ì„`;
                
                // ë°ì´í„° ì—…ë°ì´íŠ¸
                updateDashboard();
                
                // UI í‘œì‹œ
                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
            }
        }

        // ë°ì´í„° ë¡œë“œ ë° ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
        async function initDashboard() {
            try {
                // ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
                const today = new Date();
                document.getElementById('baseDate').value = formatDateForInput(today);
                
                // ë§ˆì¼“ ëª©ë¡ ë¡œë“œ
                await loadMarkets();
                
                // ë¡œì»¬ JSON íŒŒì¼ì´ ìˆìœ¼ë©´ ë¡œë“œ ì‹œë„
                try {
                    const response = await fetch('KRW-BTC_2025-03-24_00-00-00_100.json');
                    if (response.ok) {
                        allData = await response.json();
                        filteredData = [...allData];
                        
                        // ë‚ ì§œ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                        const oldestDate = allData[allData.length - 1].candle_date_time_kst;
                        const newestDate = allData[0].candle_date_time_kst;
                        document.getElementById('startDate').value = formatDateForInput(oldestDate);
                        document.getElementById('endDate').value = formatDateForInput(newestDate);
                        
                        // ë°ì´í„° ì—…ë°ì´íŠ¸
                        updateDashboard();
                    }
                } catch (e) {
                    // ë¡œì»¬ íŒŒì¼ì´ ì—†ìœ¼ë©´ ë¬´ì‹œ
                    console.log('ë¡œì»¬ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. APIì—ì„œ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ì„¸ìš”.');
                }
                
                // UI í‘œì‹œ
                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
            }
        }

        // ë‚ ì§œ í•„í„° ì ìš©
        function applyDateFilter() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            
            if (isNaN(startDate) || isNaN(endDate)) {
                alert('ì˜¬ë°”ë¥¸ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (startDate > endDate) {
                alert('ì‹œì‘ì¼ì€ ì¢…ë£Œì¼ë³´ë‹¤ ì•ì„œì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            // ë‚ ì§œ í•„í„°ë§
            filteredData = allData.filter(item => {
                const itemDate = new Date(item.candle_date_time_kst);
                return itemDate >= startDate && itemDate <= endDate;
            });
            
            if (filteredData.length === 0) {
                alert('ì„ íƒí•œ ê¸°ê°„ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
            updateDashboard();
            
            // ë‚ ì§œ ë²”ìœ„ í‘œì‹œ
            document.getElementById('dateRangeDisplay').textContent = 
                `í‘œì‹œ ê¸°ê°„: ${formatDate(filteredData[filteredData.length - 1].candle_date_time_kst)} ~ ${formatDate(filteredData[0].candle_date_time_kst)} (${filteredData.length}ì¼)`;
        }

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        function updateDashboard() {
            if (!filteredData || filteredData.length === 0) {
                console.warn('í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ë°ì´í„°ê°€ ìµœì‹ ìˆœì´ë¯€ë¡œ ì²« ë²ˆì§¸ê°€ ìµœì‹  ë°ì´í„°
            const latestData = filteredData[0];
            const oldestData = filteredData[filteredData.length - 1];
            
            // ì£¼ìš” ì§€í‘œ ì—…ë°ì´íŠ¸
            updateMainStats(latestData);
            
            // ê¸°ê°„ í†µê³„ ì—…ë°ì´íŠ¸
            updatePeriodStats(filteredData);
            
            // ì°¨íŠ¸ ìƒì„± (ë°ì´í„°ë¥¼ ì˜¤ë˜ëœ ìˆœìœ¼ë¡œ ì •ë ¬)
            const reversedData = [...filteredData].reverse();
            createCandlestickChart(reversedData);
            createPriceChart(reversedData);
            createVolumeChart(reversedData);
            createChangeRateChart(reversedData);
            createRangeChart(reversedData);
            
            // ë°ì´í„° í…Œì´ë¸” ì—…ë°ì´íŠ¸
            updateDataTable(filteredData);
        }

        // ì£¼ìš” í†µê³„ ì—…ë°ì´íŠ¸
        function updateMainStats(data) {
            const changeRate = data.change_rate * 100;
            const isPositive = changeRate >= 0;
            
            document.getElementById('currentPrice').textContent = formatNumber(data.trade_price) + ' ì›';
            
            const priceChangeEl = document.getElementById('priceChange');
            priceChangeEl.textContent = (isPositive ? '+' : '') + formatDecimal(changeRate, 2) + '%';
            priceChangeEl.className = 'price-change ' + (isPositive ? 'price-up' : 'price-down');
            
            document.getElementById('prevClose').textContent = formatNumber(data.prev_closing_price) + ' ì›';
            
            const changePriceEl = document.getElementById('changePrice');
            changePriceEl.innerHTML = `<span class="${isPositive ? 'highlight-positive' : 'highlight-negative'}">${isPositive ? '+' : ''}${formatNumber(data.change_price)} ì›</span>`;
            
            document.getElementById('tradePrice').textContent = formatLargeNumber(data.candle_acc_trade_price) + ' ì›';
            document.getElementById('tradeVolume').textContent = formatDecimal(data.candle_acc_trade_volume, 4) + ' BTC';
            document.getElementById('avgPrice').textContent = formatNumber(data.candle_acc_trade_price / data.candle_acc_trade_volume) + ' ì›';
            
            document.getElementById('highPrice').textContent = formatNumber(data.high_price) + ' ì›';
            document.getElementById('lowPrice').textContent = formatNumber(data.low_price) + ' ì›';
            document.getElementById('openPrice').textContent = formatNumber(data.opening_price) + ' ì›';
            
            const priceRange = data.high_price - data.low_price;
            document.getElementById('priceRange').textContent = formatNumber(priceRange) + ' ì› (' + formatDecimal((priceRange / data.low_price) * 100, 2) + '%)';
            
            document.getElementById('lastUpdate').textContent = formatDate(data.candle_date_time_kst);
        }

        // ê¸°ê°„ í†µê³„ ì—…ë°ì´íŠ¸
        function updatePeriodStats(data) {
            const prices = data.map(d => d.trade_price);
            const highPrices = data.map(d => d.high_price);
            const lowPrices = data.map(d => d.low_price);
            const changeRates = data.map(d => d.change_rate * 100);
            const volumes = data.map(d => d.candle_acc_trade_volume);
            
            const periodHigh = Math.max(...highPrices);
            const periodLow = Math.min(...lowPrices);
            const avgPrice = prices.reduce((a, b) => a + b, 0) / prices.length;
            const totalVolume = volumes.reduce((a, b) => a + b, 0);
            
            document.getElementById('periodHighPrice').textContent = formatNumber(periodHigh) + ' ì›';
            document.getElementById('periodLowPrice').textContent = formatNumber(periodLow) + ' ì›';
            document.getElementById('periodAvgPrice').textContent = formatNumber(avgPrice) + ' ì›';
            document.getElementById('totalVolume').textContent = formatDecimal(totalVolume, 2) + ' BTC';
            
            // ë³€ë™ì„± ë¶„ì„
            const avgChangeRate = changeRates.reduce((a, b) => a + Math.abs(b), 0) / changeRates.length;
            const maxChangeRate = Math.max(...changeRates.map(Math.abs));
            const dailyRanges = data.map(d => d.high_price - d.low_price);
            const avgDailyRange = dailyRanges.reduce((a, b) => a + b, 0) / dailyRanges.length;
            
            document.getElementById('avgChangeRate').textContent = formatDecimal(avgChangeRate, 2) + '%';
            document.getElementById('maxChangeRate').textContent = formatDecimal(maxChangeRate, 2) + '%';
            document.getElementById('avgDailyRange').textContent = formatNumber(avgDailyRange) + ' ì›';
            
            // ì¶”ì„¸ ë¶„ì„
            const upDays = changeRates.filter(r => r > 0).length;
            const downDays = changeRates.filter(r => r < 0).length;
            const winRate = (upDays / (upDays + downDays)) * 100;
            
            const oldestPrice = data[data.length - 1].trade_price;
            const newestPrice = data[0].trade_price;
            const totalReturn = ((newestPrice - oldestPrice) / oldestPrice) * 100;
            
            document.getElementById('upDays').innerHTML = `<span class="highlight-positive">${upDays}ì¼</span>`;
            document.getElementById('downDays').innerHTML = `<span class="highlight-negative">${downDays}ì¼</span>`;
            document.getElementById('winRate').textContent = formatDecimal(winRate, 1) + '%';
            
            const totalReturnEl = document.getElementById('totalReturn');
            totalReturnEl.innerHTML = `<span class="${totalReturn >= 0 ? 'highlight-positive' : 'highlight-negative'}">${totalReturn >= 0 ? '+' : ''}${formatDecimal(totalReturn, 2)}%</span>`;
        }

        // ìº”ë“¤ìŠ¤í‹± ì°¨íŠ¸ ìƒì„±
        function createCandlestickChart(data) {
            const ctx = document.getElementById('candlestickChart').getContext('2d');
            
            if (candlestickChartInstance) {
                candlestickChartInstance.destroy();
            }
            
            const candlestickData = data.map(d => ({
                x: new Date(d.candle_date_time_kst).getTime(),
                o: d.opening_price,
                h: d.high_price,
                l: d.low_price,
                c: d.trade_price
            }));
            
            candlestickChartInstance = new Chart(ctx, {
                type: 'candlestick',
                data: {
                    datasets: [{
                        label: currentMarket || 'BTC/KRW',
                        data: candlestickData,
                        color: {
                            up: '#2e7d32',
                            down: '#c62828',
                            unchanged: '#999'
                        },
                        borderColor: {
                            up: '#2e7d32',
                            down: '#c62828',
                            unchanged: '#999'
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    return [
                                        'ì‹œê°€: ' + formatNumber(point.o) + ' ì›',
                                        'ê³ ê°€: ' + formatNumber(point.h) + ' ì›',
                                        'ì €ê°€: ' + formatNumber(point.l) + ' ì›',
                                        'ì¢…ê°€: ' + formatNumber(point.c) + ' ì›'
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                displayFormats: {
                                    day: 'MM/dd'
                                }
                            },
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return formatNumber(value) + ' ì›';
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    }
                }
            });
        }

        // ì´ë™í‰ê· ì„  ê³„ì‚°
        function calculateMA(data, period) {
            const result = [];
            for (let i = 0; i < data.length; i++) {
                if (i < period - 1) {
                    result.push(null);
                } else {
                    const sum = data.slice(i - period + 1, i + 1).reduce((a, b) => a + b.trade_price, 0);
                    result.push(sum / period);
                }
            }
            return result;
        }

        // ê°€ê²© ì°¨íŠ¸ ìƒì„± (ì´ë™í‰ê· ì„  í¬í•¨)
        function createPriceChart(data) {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            if (priceChartInstance) {
                priceChartInstance.destroy();
            }
            
            const ma5 = calculateMA(data, 5);
            const ma20 = calculateMA(data, 20);
            
            priceChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => formatDate(d.candle_date_time_kst)),
                    datasets: [{
                        label: 'ì¢…ê°€',
                        data: data.map(d => d.trade_price),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        borderWidth: 2
                    }, {
                        label: '5ì¼ ì´ë™í‰ê· ',
                        data: ma5,
                        borderColor: '#ff6b6b',
                        backgroundColor: 'transparent',
                        tension: 0.4,
                        pointRadius: 0,
                        borderWidth: 1.5,
                        borderDash: [5, 5]
                    }, {
                        label: '20ì¼ ì´ë™í‰ê· ',
                        data: ma20,
                        borderColor: '#4ecdc4',
                        backgroundColor: 'transparent',
                        tension: 0.4,
                        pointRadius: 0,
                        borderWidth: 1.5,
                        borderDash: [5, 5]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatNumber(context.parsed.y) + ' ì›';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return formatNumber(value);
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                maxTicksLimit: 10
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // ê±°ë˜ëŸ‰ ì°¨íŠ¸ ìƒì„±
        function createVolumeChart(data) {
            const ctx = document.getElementById('volumeChart').getContext('2d');
            
            if (volumeChartInstance) {
                volumeChartInstance.destroy();
            }
            
            volumeChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => formatDate(d.candle_date_time_kst)),
                    datasets: [{
                        label: 'ê±°ë˜ëŸ‰',
                        data: data.map(d => d.candle_acc_trade_volume),
                        backgroundColor: data.map(d => 
                            d.change_rate >= 0 ? 'rgba(46, 125, 50, 0.6)' : 'rgba(198, 40, 40, 0.6)'
                        ),
                        borderColor: data.map(d => 
                            d.change_rate >= 0 ? 'rgba(46, 125, 50, 1)' : 'rgba(198, 40, 40, 1)'
                        ),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'ê±°ë˜ëŸ‰: ' + formatDecimal(context.parsed.y, 2) + ' BTC';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return formatDecimal(value, 0);
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                maxTicksLimit: 10
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // ë³€ë™ë¥  ì°¨íŠ¸ ìƒì„±
        function createChangeRateChart(data) {
            const ctx = document.getElementById('changeRateChart').getContext('2d');
            
            if (changeRateChartInstance) {
                changeRateChartInstance.destroy();
            }
            
            changeRateChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => formatDate(d.candle_date_time_kst)),
                    datasets: [{
                        label: 'ë³€ë™ë¥ ',
                        data: data.map(d => d.change_rate * 100),
                        backgroundColor: data.map(d => 
                            d.change_rate >= 0 ? 'rgba(46, 125, 50, 0.6)' : 'rgba(198, 40, 40, 0.6)'
                        ),
                        borderColor: data.map(d => 
                            d.change_rate >= 0 ? 'rgba(46, 125, 50, 1)' : 'rgba(198, 40, 40, 1)'
                        ),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'ë³€ë™ë¥ : ' + formatDecimal(context.parsed.y, 2) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return formatDecimal(value, 1) + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                maxTicksLimit: 10
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // ë³€ë™í­ ì°¨íŠ¸ ìƒì„±
        function createRangeChart(data) {
            const ctx = document.getElementById('rangeChart').getContext('2d');
            
            if (rangeChartInstance) {
                rangeChartInstance.destroy();
            }
            
            rangeChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => formatDate(d.candle_date_time_kst)),
                    datasets: [{
                        label: 'ë³€ë™í­',
                        data: data.map(d => d.high_price - d.low_price),
                        backgroundColor: 'rgba(102, 126, 234, 0.6)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'ë³€ë™í­: ' + formatNumber(context.parsed.y) + ' ì›';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return formatNumber(value);
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                maxTicksLimit: 10
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // ë°ì´í„° í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateDataTable(data) {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = '';
            
            data.forEach(item => {
                const row = document.createElement('tr');
                const changeRate = item.change_rate * 100;
                const changeClass = changeRate >= 0 ? 'highlight-positive' : 'highlight-negative';
                
                row.innerHTML = `
                    <td>${formatDate(item.candle_date_time_kst)}</td>
                    <td>${formatNumber(item.opening_price)}</td>
                    <td>${formatNumber(item.high_price)}</td>
                    <td>${formatNumber(item.low_price)}</td>
                    <td>${formatNumber(item.trade_price)}</td>
                    <td class="${changeClass}">${changeRate >= 0 ? '+' : ''}${formatDecimal(changeRate, 2)}%</td>
                    <td>${formatDecimal(item.candle_acc_trade_volume, 2)}</td>
                    <td>${formatLargeNumber(item.candle_acc_trade_price)}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
        window.addEventListener('load', initDashboard);
    </script>
</body>
</html>
